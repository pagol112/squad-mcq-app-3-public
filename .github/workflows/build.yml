name: Squad MCQ App Build

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    env:env:
  ANDROID_HOME: ${{ env.HOME }}/android-sdk

    steps:
    - name: ✅ Checkout Code
      uses: actions/checkout@v3

    - name: ✅ Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip zip unzip openjdk-17-jdk-headless
        pip3 install --upgrade pip
        pip3 install buildozer

    - name: ✅ Setup Android SDK & AIDL
      run: |
        mkdir -p $ANDROID_HOME/cmdline-tools
        cd $ANDROID_HOME
        wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip \
          -O cmdline-tools.zip
        unzip cmdline-tools.zip
        mv cmdline-tools $ANDROID_HOME/cmdline-tools/latest

        export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH
        yes | sdkmanager --licenses

        sdkmanager "platform-tools" \
                   "platforms;android-33" \
                   "build-tools;33.0.2"

        # verify aidl binary exists
        ls -la $ANDROID_HOME/build-tools/33.0.2/aidl

    - name: ✅ Build APK
      run: |
        export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH
        buildozer -v android debug

    - name: ✅ Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: squad-mcq-app
        path: bin/*.apk
